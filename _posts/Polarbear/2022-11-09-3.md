---
title: "[Unity] 아이템 및 인벤토리 구현"
excerpt: "[Unity] 아이템 및 인벤토리 구현"
categories: [Polarbear]
tags: [unity, polarbear, study]
toc: true
toc_sticky: true
---

## ✏️첫 구상

+ 클래스를 구현하기 전에 러프하게 생각해본 변수와 기능들이다.     
    + <u>아이템 데이터 클래스</u>
        + 아이템들에 대한 데이터
    
    + <u>아이템 클래스</u> 
        + 아이템 이름  
        + 아이템 유형 - enum
        + 아이템 이미지
        + 아이템 프리팹
        + 아이템 개수
        + 아이템 효과(기능)  
       
        + 아이템 획득
            + 가까이 다가가면 키 활성화 + 획득  
            + (콜라는 충돌하면 획득 가능..?)  

        + 아이템 사용
            + 키를 누르면 상황에 맞는 아이템이 자동으로 빠져나감
            + 콜라30개 모아 페인트로 변환한다고 할때, 어떤 방식으로 변환시킬지. 예를 들면 더블클릭 뭐 오른쪽 버튼 눌러서 바디페인팅으로 변환 등
        + 아이템 인식 영역(Raycast)
        + 아이템 드래그 
        + 아이템 클릭시
  
    + <u>아이템 툴팁(설명)</u>  
        + 인벤토리 내에서 마우스 위로 올리면 설명 볼 수 있음

    + <u>인벤토리 클래스</u> 
        + 아이템 추가
        + 이이템 사용(감소 및 삭제)
        + 아이템 드래그 및 위치변경

    + <u>슬롯</u>

<br>

## ActivatingKeyTrigger 

+ 상호작용하는 오브젝트 가까이 다가가면 활성화 됨

+ 아이템을 키를 누르면 획득하도록 함

+ 전체 코드

```cs
    using System.Collections;
    using System.Collections.Generic;
    using UnityEngine;
    using System;

    [ExecuteInEditMode]
    [RequireComponent(typeof(SphereCollider))]
    public class ActivatingKeyTrigger : MonoBehaviour
    {
        #region VARIABLES & PROPERTIES
            private SphereCollider _trigger;
            private CanvasGroup _ui;

            [Range(0.1f, 100.0f)] public float radius = 1.0f;

            public KeyTriggerType type;
            public List<KeyCode> pressKey;
            public bool isDone = false;
            public bool isActive = false;
            public Action callback = null;
            public ItemObject itemObj = null;

        #endregion

        #region UNITY_EVENTS
            private void Awake() {
                _trigger = this.GetComponent<SphereCollider>();
                _trigger.isTrigger=true;

                if(!itemObj) itemObj = GetComponent<ItemObject>();
            }

            private void Start() {
                
            }

            private void Update() {
                _trigger.radius = radius;
                
                if(!isDone&&isActive&&Input.GetKey(pressKey[0])) {
                    isDone = true;
                    isActive = false;
                    switch(type) {
                        case KeyTriggerType.GetItem:
                        {
                            ItemManager.Inst.itemInventory.AddItem(itemObj.penguin.Id);
                            Destroy(itemObj.gameObject);
                            break;
                        }
                    }
                    if(callback!=null) {
                        callback();
                    } 
                }
            }
            
            private void OnTriggerEnter(Collider other) {
                if(!isDone&&other.gameObject!=this) {
                    switch(type) {
                        case KeyTriggerType.GetItem:
                        {
                            isActive=true;
                            break;
                        }
                    }
                }
            }

            
            private void OnTriggerExit(Collider other) {
                if(other.gameObject!=this) {
                    switch(type) {
                        case KeyTriggerType.GetItem:
                        {
                            isActive=false;
                            break;
                        }
                    }
                }
            }

        #endregion
    }
```

<br>

```cs
    [ExecuteInEditMode]
    [RequireComponent(typeof(SphereCollider))]
```
  + 편집 모드(Edit Mode): 게임에 변경을 가한다
  + 플레이 모드(Play Mode): 게임을 플레이함으로써 해당 변경을 테스트한다
  + 일반적으로, 유니티에서 스크립트를 구성하는 객체들은 플레이 모드에서만 실행되지만, **[ExecuteInEditMode]는 편집모드에서도 Monobehaviour 스크립트의 각 이벤트 함수가 호출되도록 해준다**

  + **[RequireComponent(typeof())]**을 사용하는 스크립트를 오브젝트에 추가하면 필요하느 컴포넌트가 자동으로 오브젝트에 추가된다. 따라서 아이템 오브젝트에 이 스크립트를 추가하면 자동으로 SphereCollider 컴포넌트가 추가된다

<br>

## VARIABLES & PROPERTIES

```cs
    private SphereCollider _trigger;
    private CanvasGroup _ui;

    [Range(0.1f, 100.0f)] public float radius = 1.0f;

    public KeyTriggerType type;
    public List<KeyCode> pressKey;
    public bool isDone = false;     
    public bool isActive = false;
    public Action callback = null;
    public ItemObject itemObj = null;
```
  + `SphereCollider` : 트리거로 쓰이게 됨. isTrigger. 아이템이 범위 내에 들어오면 주울 수 있도록 함
  + `CanvasGroup`
  + `[Range(0.1f, 100.0f)] public float radius` : 트리거 범위
  + `public KeyTriggerType type;` : enum형으로 
        ```cs
        public enum KeyTriggerType {
            GetItem,
            TalkAction,
            InterAction,
            StopSlowAction,
        }
        ```
        아이템 얻는데 쓰이는지, 엔피시와 대화할때 쓰이는지 등 구분한다

  + `public List<KeyCode> pressKey` : 누를 키

  + **public Action callback** : Action은 미리 선언된 델리게이트 변수이다.
    + Func은 반환값이 있는 메소드를 참조하는 델리게이트 변수
    + Action은 <u>반환값이 없고, 매개변수가 없는 메소드</u>를 참조하는 델리게이트 변수

<br>

## UNITY_EVENTS

### Awake()

```cs
private void Awake() {
    _trigger = this.GetComponent<SphereCollider>();
    _trigger.isTrigger=true;

    if(!itemObj) itemObj = GetComponent<ItemObject>();
}
```  
  + Awake()는 Start보다 더 먼저 호출되는 함수로 초기화할때 쓰임
  + 트리거는 플레이어가 아이템 주울 수 있는 범위 안에 들어왔는지 확인하는 용도
  + 오브젝트의 콜라이더 컴포넌트를 가져오고, isTrigger를 체크해줌
  + 만약 아이템이 없으면 오브젝트의 ItemObject 컴포넌트를 가져옴

<br>

### Update()

```cs
private void Update() {
    _trigger.radius = radius;
            
    if(!isDone&&isActive&&Input.GetKey(pressKey[0])) {
        isDone = true;
        isActive = false;
        
        switch(type) {
            case KeyTriggerType.GetItem:
                {
                    ItemManager.Inst.itemInventory.AddItem(itemObj.penguin.Id);
                    Destroy(itemObj.gameObject);
                    break;
                }
        }
        if(callback!=null) {
            callback();
        } 
    }
}
```
  + 매 프레임마다 호출
  + 지금 이 스크립트는 편집모드에서 변경사항을 반영해야하기 때문에 radius도 새롭게 받아준다
  + 만약 아이템이 범위내에 있고, 먹지 않았고 해당 키를 누른다면, 상호작용을 시작한다
    + 키 용도가 아이템을 얻는 것이라면 인벤토리에 아이템을 추가하고, 해당 아이템은 씬에서 삭제시킨다

<br>

### onTriggerEnter || onTrigerExit

```cs
private void OnTriggerEnter(Collider other) {
    if(!isDone&&other.gameObject!=this) {
        switch(type) {
            case KeyTriggerType.GetItem:
            {
                isActive=true;
                break;
            }
        }
    }
}

            
private void OnTriggerExit(Collider other) {
    if(other.gameObject!=this) {
        switch(type) {
            case KeyTriggerType.GetItem:
            {
                isActive=false;
                break;
            }
        }
    }
}

```

  + 유니티 이벤트 함수
  + 이 함수를 통해 충돌을 감지한다. 여기선 아이템 인식 범위 내에 플레이어가 들어왔는지 안왔는지의 용도로 쓰인다

  + OnTriggerEnter
    + 두 개의 게임오브젝트가 충돌할 때 호출
    + 만약 먹지 않았고, 충돌체가 다른 아이템이 아닌경우, 즉 플레이어와 충돌된 경우, 키트리거타입이 아이템을 얻는 용도이면 아이템을 먹을 수 있도록 isActive를 활성화시킨다

  + OnTriggerExit
    + 두 개의 게임오브젝트가 충돌을 멈춘 후 호출
    + 플레이어와 아이템간의 충돌이 사라지면 isActive를 꺼서 줍지못하도록 한다

<br>

## Inventory

